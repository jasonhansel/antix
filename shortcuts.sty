
\newcommand{\dfff}{\mathrm{d}}

\ExplSyntaxOn
\tl_new:N \l_demo_tl
\seq_new:N \l_seq
\cs_new:Npn \dff #1 {
    \tl_set:Nn \l_demo_tl {#1}
    \seq_clear:N \l_seq
    \regex_extract_all:nnNTF {.(?:_.|)} {#1} \l_seq {
        \dfff\seq_use:Nnnn \l_seq {\wedge\dfff}{\wedge\dfff}{\wedge\dfff}
    }{fail}
}
\ExplSyntaxOff


%\newcommand{\dform}[1]{\mathrm{d}#1 }
%\newcommand{\dffinner}[2]{\dform{#1}\stringprocess{\dform}{#2}}


\newenvironment{wrapmath}[1][]{
\nostar\begin{minipage}[t]{\linewidth}
\vspace{-3.5mm}\begin{dmath*}[#1]
}{
\end{dmath*}\clearpage\end{minipage}
}
% \clearpage fixes whitespace iss.

\newcommand{\env}[2]{\begin{#1}#2\end{#1}}
\newcommand{\wrap}[2][]{
\nostar\parbox[t]{\linewidth}{\vspace{-3.5mm}\begin{dmath*}[#1]
#2
\end{dmath*}\clearpage}
}

%\let\olddot\dot
%\renewcommand{\dot}[1][]{\olddot #1}

% MATH SHORTCUTS

% (In)equalities
\newcommand{\gte}{\geq}
\newcommand{\lte}{\leq}
\newcommand{\lt}{<}
\newcommand{\gt}{>}
\renewcommand{\ne}{\neq}
\newcommand{\abt}{\approx}

% Sets
\newcommand{\nin}{\notin}
\newcommand{\unin}{\cup}
\newcommand{\isec}{\cap}
\newcommand{\slte}{\subseteq}
\newcommand{\nslte}{\nsubseteq}
\newcommand{\slt}{\subset}
\newcommand{\sset}{\subseteq}
\newcommand{\sz}{\abs}
\newcommand{\except}{\setminus}
\newcommand{\mt}{\varnothing}

% Logic
\let\oldOr\lor
\renewcommand{\And}{\land}
\newcommand{\Or}{\oldOr}
\newcommand{\Not}{\lnot}
\newcommand{\Iff}{\leftrightarrow}
\newcommand{\If}[1]{#1 \to}
\newcommand{\Ifp}[1]{(#1)\to}
\newcommand{\infer}[1][]{\ifthenelse{\equal{#1}{}}{\vdash}{\vdash_{\mathrm #1}}}
\newcommand{\proves}{\vdash}
\newcommand{\entails}{\vDash}
\newcommand{\nproves}{\nvdash}
\newcommand{\nentails}{\nvDash}
\newcommand{\from}[1]{#1\to}
\newcommand{\Nec}{\square}
\newcommand{\nNec}{\Not\square}
\newcommand{\Pos}{\lozenge}
\newcommand{\nPos}{\Not\lozenge}


% Isomorphism, congruence, groups
\newcommand{\iso}{\cong}
\newcommand{\niso}{\not{\iso}}
\newcommand{\nsg}{\triangleleft}
\newcommand{\con}{\mathrel{\equiv}}
\newcommand{\ncon}{\not\equiv}
\newcommand{\adjoin}[1]{\lbrack#1\rbrack}


% Greek leters
\newcommand{\alp}{\ensuremath{\alpha}}
\newcommand{\fee}{\ensuremath{\varphi}\xspace}
\let\oldphi\phi
\AtBeginDocument{ % Make sure to load these after Times New Roman stuff
	\renewcommand{\^}{\wedge}
	\renewcommand{\l}{\lambda}
	\renewcommand{\phi}[1][]{\ifthenelse{\equal{#1}{}}{\oldphi}{\oldphi(#1)}}
}




% Functions
\newcommand{\pose}{\circ}
\newcommand{\fin}{f^{-1}}
\newcommand{\fbar}{\overline{f}}

% Font choice
\newcommand{\ur}{\mathrm}


% "Curly" (in)equality symbols
\newcommand{\crlt}{\prec}
\newcommand{\crgt}{\succ}
\newcommand{\creq}{\asymp}

% Common superscripts
\renewcommand{\exp}[1]{\ensuremath{e^{#1}}}
\renewcommand{\1}{^{-1}}
\renewcommand{\2}{^{-2}}
\newcommand{\T}{^{\displaystyle t}} % Transposition of a matrix

% Common "roman" text in math formulae
\newcommand{\is}{\textrm{ is }\xspace}
\newcommand{\isnt}{\textrm{ is not }\xspace}

% Common "cursive" letters, some with subscripts as arguments
\AtBeginDocument{
    \renewcommand{\vee}{\ensuremath{\mathcal{V}}\xspace}
}
\newcommand{\vi}{\textrm{V}_\mathscr{I} }
\newcommand{\ee}{\ensuremath{\mathcal{E}}\xspace}
\newcommand{\el}{\ensuremath{\mathcal{L}}\xspace}
\newcommand{\ayy}{\ci{A}\xspace}
\newcommand{\ess}{\ensuremath{\mathcal{S}}\xspace}
\newcommand{\ef}{\ensuremath{\mathcal{F}}\xspace}
\newcommand{\kay}[1][]{\ensuremath{\ifthenelse{\equal{#1}{}}{\mathcal{K}}{\mathcal{K}_{#1}}}}
\newcommand{\gee}[1][]{\ensuremath{\ifthenelse{\equal{#1}{}}{\mathcal{G}}{\mathcal{G}_{#1}}}}

% Computer science
\newcommand{\subtype}{\mathbin{<:}}
\newcommand{\Oh}[1]{\mathcal{O}\left(#1\right)}

% Misc common symbols
\newcommand{\G}{\Gamma}
\newcommand{\g}{\gamma}
\renewcommand{\P}[1]{\mathrm{P}(\kern-0.5pt#1)}
\newcommand{\tri}{\triangle}
\newcommand{\ox}{\otimes}
\newcommand{\x}{\times}
\newcommand{\op}{\ensuremath{\oplus}\xspace} % "Outer" product
\newcommand{\ip}{\ensuremath{\times}\xspace} % "Inner" product
\newcommand{\eqdf}{\coloneqq}
\newcommand{\vh}{\ensuremath{\hat{V}}\xspace}
\newcommand{\bz}{\bm{0}}
\newcommand{\chk}{\ensuremath{\checkmark}}
\renewcommand{\tilde}{\ensuremath{\raise.18ex\hbox{$\scriptstyle\sim$}}}

% Various uses of vertical bars
\newcommand{\given}{\mid}
\newcommand{\where}{\mid}
\newcommand{\ndiv}{\nmid}

% Analysis
\newcommand{\dee}[2]{\partial_{#1}#2}
\newcommand{\D}[2][]{\mathrm{D}_{#2}^{#1}}
\renewcommand{\P}[2][]{\partial_{#2}^{#1}}
\newcommand{\DF}[1]{\dff{#1}}
\newcommand{\per}[1]{\:\mathrm{d}#1}
\newcommand{\X}{\mathrm{d}}
\newcommand{\Dee}[2]{\frac{\partial #2}{\partial #1}}
\newcommand{\LR}[2]{\Lambda^{#1}\R^{#2}}

% Ellipsis
\newcommand{\etc}{\ensuremath{\cdots}\xspace}
\newcommand{\letc}{\;\etc\;}
\newcommand{\etco}[1]{#1\etc#1}

% Brackets, braces, etc.
\newcommand{\<}[1]{\langle#1\rangle}
\newcommand{\bpar}[1]{\bm{(} #1 \bm{)}}
\newcommand{\of}[1]{\del{#1}}


% Fractions and radicals
\newcommand{\rt}{\sqrt}
\renewcommand{\sf}[2]{\mathop{\nicefrac{#1}{#2}}} % Make breqn happy
\newcommand{\half}{\sf{1\kern-0.5pt}{\kern-0.5pt2}}
\newcommand{\halve}[1]{\sf{#1}{2}}
\newcommand{\ofpi}[2]{\sf{#1}{#2}\pi}


% amsmath delimiters and operators
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\DeclareMathOperator{\im}{im}
\let\Cap\relax
\DeclareMathOperator{\Cap}{cap}
\DeclareMathOperator{\area}{area}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\Grad}{grad}
\DeclareMathOperator{\Exp}{exp}
\DeclareMathOperator{\orb}{orb}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Ker}{Ker}
\DeclareMathOperator{\Char}{char}
\DeclareMathOperator{\stab}{stab}
\DeclareMathOperator{\spn}{span}
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\rng}{rng}
\DeclareMathOperator{\Div}{div}
\DeclareMathOperator{\Curl}{curl}

% Division
\let\iover\div
\newcommand{\inlinediv}{\mathbin{\iover}\,}
\renewcommand{\div}{\mathbin{\mid}}

% Text styles
\newcommand{\lin}{\overline}
\newcommand{\mathsc}[1]{\text{\normalfont\scshape#1}}
	% See http://tex.stackexchange.com/questions/13040/


% Common sets of numbers
\newcommand{\N}{\mathbb{N}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\C}{\mathbb{C}}

% Inverses and reciprocals
\newcommand{\inv}[1]{\ensuremath{\frac{1}{#1}}}
\newcommand{\sinv}[1]{\ensuremath{\sf{1}{#1}}}
\newcommand{\gin}[1]{\ensuremath{#1^{-1}}}

% Formal languages
\newcommand{\lang}[1]{\set{#1}^{\star}}